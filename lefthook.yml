# Lefthook の設定ファイル
# pre-commit hook を使用してコード品質をコミット前に確保する

pre-commit:
  parallel: true
  commands:
    # EditorConfig準拠チェック
    editorconfig-check:
      run: ec
      tags: format

    # ktlint によるコードスタイルチェック
    ktlint-check:
      glob: "**/*.{kt,kts}"
      run: ./gradlew ktlintCheck --daemon
      tags: format lint

    # Terraform フォーマットチェック
    terraform-fmt-check:
      glob: "infra/*.tf"
      run: terraform fmt -check infra/
      tags: format

    # Terraform バリデーション
    terraform-validate:
      glob: "infra/*.tf"
      run: cd infra && terraform init -backend=false && terraform validate
      tags: lint

pre-push:
  commands:
    # プッシュ前に全体のテストを実行
    full-test:
      run: ./gradlew test
      tags: test

commit-msg:
  commands:
    # コミットメッセージのフォーマットチェック（オプション）
    commitizen-check:
      run: |
        if ! echo "$(head -n1 {1})" | grep -E "^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}" > /dev/null; then
          echo "コミットメッセージは conventional commit 形式で記述してください"
          echo "例: feat: 新機能を追加"
          echo "例: fix: バグを修正"
          echo "例: docs: ドキュメントを更新"
          exit 1
        fi
      tags: commit-msg
